## 경로 조회 기능 목록

- [x] 기존 API 스펙 수정하기
    - [x] 노선 등록 시 추가 요금 등록 추가
    - [x] 노선 조회 시 추가 요금 정보 응답 추가
    - [x] 노선 수정 시 추가 요금 정보 추가

- [x] 출발역과 도착역 사이의 최단 거리 경로를 구하는 API를 구현하기
    - [x] 구간 정보를 이용하여 최단 거리, 최단 경로를 구하는 도메인(Path)를 구현한다.
    - [x] 경로 조회 시 출발역, 도착역, 나이를 받는다
    - [x] 경로 조회 시 최단 거리 경로에 속하는 역들의 정보, 최종 거리, 요금을 응답한다.
        - [x] 역들의 정보
        - [x] 최종 거리
        - [x] 요금

- [ ] 노선별 추가 요금 적용
    - [x] 최단 경로 중 이용한 노선을 구한다.
    - [x] 추가 요금이 있는 노선을 이용 할 경우 측정된 요금에 추가
        - ex) 900원 추가 요금이 있는 노선 8km 이용 시 1,250원 -> 2,150원
        - ex) 900원 추가 요금이 있는 노선 12km 이용 시 1,350원 -> 2,250원
    - [x] 경로 중 추가요금이 있는 노선을 환승 하여 이용 할 경우 가장 높은 금액의 추가 요금만 적용
        - ex) 0원, 500원, 900원의 추가 요금이 있는 노선들을 경유하여 8km 이용 시 1,250원 -> 2,150원
    - [ ] 연령별 요금 할인
        - [ ] 청소년: 운임에서 350원을 공제한 금액의 20%할인
        - [ ] 어린이: 운임에서 350원을 공제한 금액의 50%할인

```text
기본운임(10㎞ 이내): 기본운임 1,250원
이용 거리 초과 시 추가운임 부과
    10km~50km: 5km 까지 마다 100원 추가
    50km 초과: 8km 까지 마다 100원 추가
```

---

## 1 단계 피드백, 수정사항

- [x] Controller와 Converter는 앞에 문자도 겹치고 각 도메인별로 모두 있어서 헷갈릴 수 있을 것 같은데요, 패키지를 분리해 보면 어떨까요?
- [x] (컨트롤러) 보통 Info라는 단어는 명확한 의미를 드러내지 못하는 경우가 많아 지양하는 것이 좋은데요, 여기서도 마찬가지인 것 같아요.
    - 코드에서 Controller가 요청을 받거나 응답을 주는 객체를 그대로 서비스에서 쓰지 않고 서비스와 컨트롤러 사이의 dto가 있습니다.
    - toInfo와 dto.info의 의미는 컨트롤러와 서비스 사이에 정보를 주고받는 dto를 의미합니다.
    - 하지만 제가 생각해도 이해가 쉽지 않다고 느꼈고 이부분을 조금 더 명확하게 toServiceRequest로 수정하고 dto.info를 dto.service로 수정했습니다.
- [x] (Advice) IllegalArgumentException만 핸들링하면 될까?
    - Advice에서는 애플리케이션에서 내가 정할 수 있는 가능한 모든 에러를 핸들링합니다.
    - 하지만 예상하지 못하는 에러가 생길 수 있기 때문에 내가 처리하지 못한 에러도 핸들할 수 있도록 `Exception.class`도 추가했습니다.
- [x] (PathAcceptanceTest) test()는 무엇을 테스트 하고 있나요?
    - `@DisplayName`과 메서드명 수정으로 어떤 테스트인지 나타내도록 수정했습니다.
- [x] 어차피 테스트를 위한 메서드이기 때문에 ForTest는 지워도 될 것 같다
- [x] 어떤 결과를 이용한는 것이 아니면 변수를 할당할 필요는 없을 것 같다
- [x] (@ParameterizedTest(name = "{displayName} : {arguments}")) 이름에서 숫자와 단위까지 함께 보여주면 더 좋을 것 같아요.
- [x] CsvSource 에서 Integer로 받을 수 있다.
- [x] Fare가 필요한 이유가 있을까요?
    - Fare을 만들면서도 꼭 필요할지 생각했었는데 의미없이 하나의 과정이 더해진 느낌이 들어서 제거했습니다.
    - 요금에 대한 값을 가지고 어떤 로직이 생긴다면 다시 생성을 고려해봐야될 것 같습니다.
- [x] (PathService) 사용하지 않는 변수가 있다.
- [x] (validateNotExists) 이 메서드의 이름만 봐서는 존재하지 않음을 검증한다, 즉 비즈니스 로직상 "존재하지 않아야 한다"로 생각되네요.
- [x] 조회하기 전 존재 여부를 확인하는 이유
    - 값을 단일 조회했을 때 값이 없으면 그에 맞는 처리를 해주어야합니다.
    - 찾는 값이 없는 경우 `NosuchElementException`를 발생시키고 예외를 핸들링하여 advice에서 상태 코드 404와 에러 메시지를 전송합니다.
    - 이 방식이 아니라면 찾는 값이 없으면 DAO에서 null 또는 Optional.empty() 값이 반환되게 구현할 수 있고 반환된 값이 이 값이라면 404 응답을 줄 수 있습니다.
    - 마지막으로 queryForObject를 통해 값을 찾아온다면 값이 0개일 때 `EmptyResultDataAccessException`, 값이 2개 이상인
      경우 `IncorrectResultSizeDataAccessException`이 발생한다. 이 예외를 try/catch로 잡거나 `@ExceptionHandler`로 처리하여 404 응답을 줄 수도
      있습니다.
- [x] 적절한 줄 바꿈으로 가독성을 개선해보자
- [x] 인텔리제이에서 DijkstraShortestPath에 경고를 주는 이유는 무엇일까?
    - DijkstraShortestPath를 그대로 쓰면 로타입이기 때문입니다.
    - DijkstraShortestPath을 보면 DijkstraShortestPath<V, E>으로 되어있는 것을 확인할 수 있었습니다.
    - 인텔리제이에서는 해결 방법으로 var으로 타입추론을 하라고 했지만 var이 익숙하지 않아 로타입이 아닌 구체적으로 형식을 정해주었습니다.
- [x] containsExactly로 테스트 코드를 더 간결하게 작성할 수 있다.
- [x] 예상하지 못한 예외가 발생한 경우, 이렇게 예외에서 메시지를 바로 꺼내 클라이언트에 노출해도 괜찮을까요?
    - 예상하지 못한 예외를 advice에서 핸들링하는 이유가 클라이언트에게 예외에 대한 구체적인 정보를 숨기기 위해서기도 했기 때문에 메시지를 노출하면 안될 것 같습니다.
    - 어떤 예외가 발생할지 모르기 때문에 그냥 메시지없이 상태코드만 500으로 응답하도록 수정했습니다.
- [ ] 현재 도메인 객체가 외부 라이브러리를 직접 이용하고 있는 상황인데요, 이런 경우 어떤 문제가 발생할 수 있을까요?
- [x] `PathService`를 보면 이 두 메서드는 무조건 같이 사용하게 되는데, 각각을 호출할 때마다 최단 경로를 다시 계산하고 있네요. 경로를 한 번만 계산할 방법은 없을까요?
    - `Path`의 필드로 `DijkstraShortestPath`를 가지고 생성자에서 한번 만들고 재사용 하는 방식으로 수정했습니다.
- [ ] 필수는 아니지만, 테스트 코드를 위한 데이터를 만들 때는 실제 데이터와 유사하게 하는 것이 좋아요. 비즈니스 로직 또는 테스트 자체의 맥락을 파악하기 훨씬 용이하겠죠?
- [ ] 최단 경로를 구하는 것은 우리 애플리케이션에서 아주 중요한 로직인데요, 조금 더 다양한 상황에 대해 검증해 볼 수 있지 않을까요?
- [x] 구간으로 이어져 있지 않은 역들로 경로를 구하려 하면 어떤 일이 일어나고 있나요?
  - 구간이 이어져 있지 않은 경우 404 상태 코드와 경로가 없다는 메시지를 응답하도록 수정했습니다.
